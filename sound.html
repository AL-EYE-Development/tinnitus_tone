<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tone Generator Survey</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        .column { display: inline-block; vertical-align: top; width: 30%; padding: 10px; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; }
        select, input { padding: 5px; margin: 5px; }
        #frequencyValue1, #frequencyValue2, #frequencyValue3 { font-weight: bold; }
        #frequency1, #frequency2, #frequency3 { width: 80%; }
        .status-icon { font-size: 20px; margin-left: 10px; }
    </style>
    <script type="text/javascript" src="./helper.js"></script>
</head>
<body>

    <h1>Tone Generator & Tinnitus Matching</h1>
    <br> OBS: turn down your volume before hitting play <br>

    <div class="column" id="sound1">
        <h2>Sound 1</h2>
        <label for="frequency1">Frequency (Hz): </label>
        <input type="range" id="frequency1" value="440" min="10" max="14000" step="10" oninput="updateFrequencyValue(1)">
        <br> <span id="frequencyValue1"> 440 Hz -  </span><br>
        
        <label for="waveform1">Waveform: </label>
        <select id="waveform1" onchange="updateWaveform(1)">
            <option value="sine">Sine</option>
            <option value="square">Square</option>
            <option value="triangle">Triangle</option>
            <option value="sawtooth">Sawtooth</option>
        </select>

        <br>
        <label for="volume1">Volume: </label>
        <input type="range" id="volume1" value="50" min="0" max="100" step="1" oninput="updateVolumeValue(1)">
        <span id="volumeValue1">50</span>

        <br>
        <button onclick="toggleTone(1)" id="toggleButton1">Play Tone</button>
        <span id="statusIcon1" class="status-icon" >⏹️</span>

    </div>

    <div class="column" id="addSound2">
        <button onclick="addSound(2)">Add Sound 2</button>
    </div>

    <div class="column" id="addSound3">
        <button onclick="addSound(3)">Add Sound 3</button>
    </div>

    <script>
        let audioCtx1, oscillator1, gainNode1;
        let audioCtx2, oscillator2, gainNode2;
        let audioCtx3, oscillator3, gainNode3;
        let isPlaying1 = false;
        let isPlaying2 = false;
        let isPlaying3 = false;

        function updateFrequencyValue(sound) {
            const freq = document.getElementById(`frequency${sound}`).value;
            document.getElementById(`frequencyValue${sound}`).textContent = freq;
            if (sound === 1 && oscillator1) {
                oscillator1.frequency.setValueAtTime(freq, audioCtx1.currentTime);
            } else if (sound === 2 && oscillator2) {
                oscillator2.frequency.setValueAtTime(freq, audioCtx2.currentTime);
            } else if (sound === 3 && oscillator3) {
                oscillator3.frequency.setValueAtTime(freq, audioCtx3.currentTime);
            }
            
            //print type of freq
            const note = getNoteFromFrequency(parseFloat(freq));
            document.getElementById(`frequencyValue${sound}`).textContent = `${freq} Hz ~${note}`;
        }

        function updateWaveform(sound) {
            const wave = document.getElementById(`waveform${sound}`).value;
            if (sound === 1 && oscillator1) {
                oscillator1.type = wave;
            } else if (sound === 2 && oscillator2) {
                oscillator2.type = wave;
            } else if (sound === 3 && oscillator3) {
                oscillator3.type = wave;
            }
        }

        function updateVolumeValue(sound) {
            const volume = document.getElementById(`volume${sound}`).value;
            document.getElementById(`volumeValue${sound}`).textContent = volume;
            if (sound === 1 && gainNode1) {
                gainNode1.gain.setValueAtTime(volume / 100, audioCtx1.currentTime);
            } else if (sound === 2 && gainNode2) {
                gainNode2.gain.setValueAtTime(volume / 100, audioCtx2.currentTime);
            } else if (sound === 3 && gainNode3) {
                gainNode3.gain.setValueAtTime(volume / 100, audioCtx3.currentTime);
            }
        }

        function toggleTone(sound) {
            if (sound === 1) {
                if (isPlaying1) {
                    stopTone(1);
                } else {
                    playTone(1);
                }
                isPlaying1 = !isPlaying1;
                document.getElementById("toggleButton1").textContent = isPlaying1 ? "Stop Tone" : "Play Tone";
            } else if (sound === 2) {
                if (isPlaying2) {
                    stopTone(2);
                } else {
                    playTone(2);
                }
                isPlaying2 = !isPlaying2;
                document.getElementById("toggleButton2").textContent = isPlaying2 ? "Stop Tone" : "Play Tone";
            } else if (sound === 3) {
                if (isPlaying3) {
                    stopTone(3);
                } else {
                    playTone(3);
                }
                isPlaying3 = !isPlaying3;
                document.getElementById("toggleButton3").textContent = isPlaying3 ? "Stop Tone" : "Play Tone";
            }
        }

        function playTone(sound) {
            if (sound === 1) {
                if (audioCtx1) {
                    audioCtx1.close();
                }
                const freq = document.getElementById("frequency1").value;
                const wave = document.getElementById("waveform1").value;
                const volume = document.getElementById("volume1").value;
                
                audioCtx1 = new (window.AudioContext || window.webkitAudioContext)();
                oscillator1 = audioCtx1.createOscillator();
                gainNode1 = audioCtx1.createGain();
                
                oscillator1.type = wave;
                oscillator1.frequency.setValueAtTime(freq, audioCtx1.currentTime);
                gainNode1.gain.setValueAtTime(volume / 100, audioCtx1.currentTime);
                
                oscillator1.connect(gainNode1);
                gainNode1.connect(audioCtx1.destination);
                oscillator1.start();
                document.getElementById("statusIcon1").textContent = "▶️";
            } else if (sound === 2) {
                if (audioCtx2) {
                    audioCtx2.close();
                }
                const freq = document.getElementById("frequency2").value;
                const wave = document.getElementById("waveform2").value;
                const volume = document.getElementById("volume2").value;
                
                audioCtx2 = new (window.AudioContext || window.webkitAudioContext)();
                oscillator2 = audioCtx2.createOscillator();
                gainNode2 = audioCtx2.createGain();
                
                oscillator2.type = wave;
                oscillator2.frequency.setValueAtTime(freq, audioCtx2.currentTime);
                gainNode2.gain.setValueAtTime(volume / 100, audioCtx2.currentTime);
                
                oscillator2.connect(gainNode2);
                gainNode2.connect(audioCtx2.destination);
                oscillator2.start();
                document.getElementById("statusIcon2").textContent = "▶️";
            } else if (sound === 3) {
                if (audioCtx3) {
                    audioCtx3.close();
                }
                const freq = document.getElementById("frequency3").value;
                const wave = document.getElementById("waveform3").value;
                const volume = document.getElementById("volume3").value;
                
                audioCtx3 = new (window.AudioContext || window.webkitAudioContext)();
                oscillator3 = audioCtx3.createOscillator();
                gainNode3 = audioCtx3.createGain();
                
                oscillator3.type = wave;
                oscillator3.frequency.setValueAtTime(freq, audioCtx3.currentTime);
                gainNode3.gain.setValueAtTime(volume / 100, audioCtx3.currentTime);
                
                oscillator3.connect(gainNode3);
                gainNode3.connect(audioCtx3.destination);
                oscillator3.start();
                document.getElementById("statusIcon3").textContent = "▶️";
            }
        }

        function stopTone(sound) {
            if (sound === 1 && oscillator1) {
                oscillator1.stop();
                audioCtx1.close();
                oscillator1 = null;
                audioCtx1 = null;
                document.getElementById("statusIcon1").textContent = "⏹️";
            } else if (sound === 2 && oscillator2) {
                oscillator2.stop();
                audioCtx2.close();
                oscillator2 = null;
                audioCtx2 = null;
                document.getElementById("statusIcon2").textContent = "⏹️";
            } else if (sound === 3 && oscillator3) {
                oscillator3.stop();
                audioCtx3.close();
                oscillator3 = null;
                audioCtx3 = null;
                document.getElementById("statusIcon3").textContent = "⏹️";
            }
        }

        function addSound(sound) {
            if (sound === 2) {
                document.getElementById('addSound2').innerHTML = `
                    <h2>Sound 2</h2>
                    <label for="frequency2">Frequency (Hz): </label>
                    <input type="range" id="frequency2" value="440" min="10" max="14000" step="10" oninput="updateFrequencyValue(2)">
                    <span id="frequencyValue2">440</span><br>
                    
                    <label for="waveform2">Waveform: </label>
                    <select id="waveform2" onchange="updateWaveform(2)">
                        <option value="sine">Sine</option>
                        <option value="square">Square</option>
                        <option value="triangle">Triangle</option>
                        <option value="sawtooth">Sawtooth</option>
                    </select>

                    <br>
                    <label for="volume2">Volume: </label>
                    <input type="range" id="volume2" value="50" min="0" max="100" step="1" oninput="updateVolumeValue(2)">
                    <span id="volumeValue2">50</span>

                    <br>
                    <button onclick="toggleTone(2)" id="toggleButton2">Play Tone</button>
                    <span id="statusIcon2" class="status-icon">⏹️</span>
                `;
            } else if (sound === 3) {
                document.getElementById('addSound3').innerHTML = `
                    <h2>Sound 3</h2>
                    <label for="frequency3">Frequency (Hz): </label>
                    <input type="range" id="frequency3" value="440" min="10" max="14000" step="10" oninput="updateFrequencyValue(3)">
                    <span id="frequencyValue3">440</span><br>
                    
                    <label for="waveform3">Waveform: </label>
                    <select id="waveform3" onchange="updateWaveform(3)">
                        <option value="sine">Sine</option>
                        <option value="square">Square</option>
                        <option value="triangle">Triangle</option>
                        <option value="sawtooth">Sawtooth</option>
                    </select>

                    <br>
                    <label for="volume3">Volume: </label>
                    <input type="range" id="volume3" value="50" min="0" max="100" step="1" oninput="updateVolumeValue(3)">
                    <span id="volumeValue3">50</span>

                    <br>
                    <button onclick="toggleTone(3)" id="toggleButton3">Play Tone</button>
                    <span id="statusIcon3" class="status-icon">⏹️</span>
                `;
            }
        }
    </script>

</body>
</html>